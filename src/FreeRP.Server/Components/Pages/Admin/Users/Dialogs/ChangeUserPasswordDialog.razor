@using FreeRP.User
@inject FreeRP.Localization.FrpLocalizationService i18n
@inject IDialogService dlg

<MudDialog>
    <DialogContent>
        @if (Content is not null)
        {
            <MudForm @bind-IsValid="_isValid">
                <MudTextField @bind-Value="_pass1" InputType="InputType.Password" Label="@i18n.Text.Password"
                              Required="true" RequiredError="@i18n.Text.XIsRequired.Replace("{0}", i18n.Text.Password)" />

                <MudTextField @bind-Value="_pass2" InputType="InputType.Password" Label="@i18n.Text.RepeatPassword"
                              Required="true" RequiredError="@i18n.Text.XIsRequired.Replace("{0}", i18n.Text.Password)" />
            </MudForm>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">@i18n.Text.Cancel</MudButton>
        <MudButton Disabled="(_isValid == false)" Color="Color.Primary" OnClick="Save">@i18n.Text.Ok</MudButton>
    </DialogActions>
</MudDialog>

@code {

    [CascadingParameter]
    public MudDialogInstance Dialog { get; set; } = default!;

    [Parameter]
    public FrpUser Content { get; set; } = default!;

    private bool _isValid = false;
    private string? _pass1;
    private string? _pass2;

    void Cancel() => Dialog.Cancel();

    private async Task Save()
    {
        if (_pass1 != _pass2)
        {
            await dlg.ShowMessageBox(i18n.Text.Error, i18n.Text.PasswordNotMatch, i18n.Text.Ok);
            return;
        }

        Content.Password = _pass1;
        Dialog.Close();
    }
}
